<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Mortality adjustments</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">

div.csl-bib-body { }
div.csl-entry {
clear: both;
}
.hanging div.csl-entry {
margin-left:2em;
text-indent:-2em;
}
div.csl-left-margin {
min-width:2em;
float:left;
}
div.csl-right-inline {
margin-left:2em;
padding-left:1em;
}
div.csl-indent {
margin-left: 2em;
}
</style>

<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Mortality adjustments</h1>



<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>This is the second in a series of vignettes illustrating methods for
evaluating the fit and efficiency of three state oncology
cost-effectiveness model structures, as described in an accompanying
journal article <span class="citation">(Muston 2024)</span>. The package
is heavily dependent on flexsurv <span class="citation">(Jackson
2016)</span>.</p>
<p>After fitting models, as described in
<code>vignette(&quot;example&quot;)</code>, estimates of Restricted Mean Durations
(RMDs) in health states can be calculated after constraining for
background mortality from a given life table.</p>
<div id="notation" class="section level3">
<h3>Notation</h3>
<p>We denote functions of survival, hazard and cumulative hazard as
<span class="math inline">\(S(t), h(t)\)</span> and <span class="math inline">\(H(t)\)</span>. There are ‘unadjusted’ values for
relevant endpoints (e.g. PFS) dependent on the model structure (PSM,
STM-CF or STM-CR). We assume that there is a ‘general background
mortality’, against which any extrapolations and derivations of RMD
should be constrained, denoted with subscript ‘gen’. Consequently there
are ‘adjusted’ values, denoted with superscript ‘adj’.</p>
</div>
<div id="background-mortality-survival-and-hazard-functions" class="section level3">
<h3>Background mortality survival and hazard functions</h3>
<p>Our lifetable gives us decreasing <span class="math inline">\(l_x\)</span> values at points between <span class="math inline">\(t=0, ..., t_{max}\)</span>, with <span class="math inline">\(l_{t_{max}}=0\)</span>. Let us define the
background mortality survival function as follows.</p>
<p><span class="math display">\[
S_{gen}(t) = 1 - R \left(1 - \frac{l_{x_0 + t}}{l_{x_0}} \right)
\]</span></p>
<p>where <span class="math inline">\(x_0\)</span> is the mean age of the
study population at baseline, <span class="math inline">\(R\)</span> is
a <a href="https://en.wikipedia.org/wiki/Standardized_mortality_ratio">Standardized
Mortality Ratio</a>, and <span class="math inline">\(l_x\)</span> is an
appropriate lifetable.</p>
<p>We can also derive the average background mortality hazard for <span class="math inline">\(t\)</span> in the range <span class="math inline">\([t_1, t_2)\)</span>.</p>
<p><span class="math display">\[
h_{gen}(t) = \frac{\log[S_{gen}(t_1)] - \log[S_{gen}(t_2)]}{t_2 - t_1}
\]</span></p>
</div>
</div>
<div id="what-does-constraining-for-background-mortality-mean" class="section level2">
<h2>What does constraining for background mortality mean?</h2>
<p>There are a number of approaches applied in literature and HTA
submissions, so it could mean several things!</p>
<div id="approach-1---constraining-only-the-survival-function" class="section level3">
<h3>Approach 1 - Constraining only the survival function</h3>
<p>Under this approach, the background mortality is assumed to limit the
survival function as follows. There is no direct constraint to the
hazard.</p>
<p><span class="math display">\[
S^{adj}(t) = \min \left[ S(t), S_{gen}(t) \right]
\]</span></p>
<p>This is a simple approach, and has been used at least one NICE
technology appraisal <span class="citation">(National Institute for
Health and Care Excellence 2022)</span>:</p>
<blockquote>
<p>“Patient longevity is always the lesser of values generated from the
disease-specific survival curve (after adjustment for treatment and
functional status) and the survival curve for the general population
according to age and sex.”</p>
</blockquote>
<p>However, this approach does not ensure that the hazard is at least as
great as the hazard of background mortality.</p>
</div>
<div id="approach-2---constraining-the-hazard-function" class="section level3">
<h3>Approach 2 - Constraining the hazard function</h3>
<p>A more rigorous adjustment would be that the hazard of background
mortality acts as a constraint to the unadjusted hazard <span class="citation">(Sweeting et al. 2023)</span>.</p>
<p><span class="math display">\[
h^{adj}(t) = \max \left[ h(t), h_{gen}(t) \right]
\]</span> <span class="math display">\[
\implies S^{adj}(t) = \exp \left[ - \int_0^t h^{adj}(u) du \right]
\]</span></p>
<p>In either case, we must assume that the original dataset was NOT
subject to background mortality. Although unlikely to be true, this is a
common, pragmatic assumption in cost-effectiveness models as long as
background mortality is relatively insignificant during trial
follow-up.</p>
</div>
<div id="approach-3---modeling-excess-hazard-in-the-original-dataset" class="section level3">
<h3>Approach 3 - Modeling excess hazard in the original dataset</h3>
<p>The above approaches work by adjusting extrapolations made from
models fitted to data assumed to be not subject to background mortality.
If - as is likely - the population in the dataset were in fact subject
to background mortality, then it would be better to model that dataset
using excess hazard methods rather than to seek to make adjustments to
extrapolations after the fact. Further discussion of survival
extrapolation incorporating general population mortality is provided by
<span class="citation">Sweeting et al. (2023)</span>.</p>
</div>
</div>
<div id="application-to-3-state-state-transition-models-stms" class="section level2">
<h2>Application to 3-state State Transition Models (STMs)</h2>
<p>As discussed previously, state transition models with three states
may be clock forward (‘STM-CF’) or ‘clock reset’ (STM-CR). Such
structures involve modeling each transition directly, which may be
performed by fitting survival distributions to the TTP, PPD and PPS
endpoints.</p>
<p>In general, we wish to constrain the pre- and post-progression
mortality (PPD and PPS) are at least as great as background
mortality.</p>
<p><span class="math display">\[
h^{adj}_{PPD}(t) = \max \left[h_{gen}(t), h_{PPD}(t) \right] \\
h^{adj}_{PPS}(t) = \max \left[h_{gen}(t), h_{PPS}(t) \right] \\
\]</span></p>
<p>Formulas for the mean time in PF and OS are shown in the accompanying
article in respect of hazard and survival functions for TTP, PPD and PPS
endpoints, where PPS is a function of time from baseline in a Clock
Forward (CF) and time from progression in a Clock Reset (CR) model.
Adjusting for background mortality requires using the adjusted rather
than unadjusted hazards for PPD and PPS in formulae.</p>
<p>This is straightforward enough for the PPD endpoint in the STM-CF and
STM-CR structures, and for the PPS endpoint in the STM-CF structure.
However matters are more complex for the PPS endpoint for the STM-CF
since its hazard and survival are functions of two times (time from
progression and time from baseline) rather than just one (time from
baseline). This package does not provide integral solutions relying on
continuous time for RMDs, and must instead rely on discretization.</p>
<p>Spreadsheet-based economic models almost always rely on discretizing
time into timesteps rather than follow the integral formulas described
above for continuous time. As long as timesteps are reasonably short,
restricted mean duration results should remain reasonably accurate.
Derided as a “kludge”, half-cycle corrections are nevertheless
recommended <span class="citation">(Naimark, Kabboul, and Krahn
2013)</span>. The package provides discretized calculations.</p>
</div>
<div id="application-to-partitioned-survival-models-psm" class="section level2">
<h2>Application to Partitioned Survival Models (PSM)</h2>
<p>The RMD in the PF state and time alive are integrals over the time
horizon, <span class="math inline">\(T\)</span>, of the survival
functions of the endpoints PFS and OS. Endpoints PPD and PPS are not
explicitly defined.</p>
<p>However as discussed in the accompanying manuscript, TTP - and
therefore the PPD and PPS endpoints which directly follow once PFS and
OS are defined - are often in practice implicitly defined in PSM
economic model in order to calculate payoffs that depend on progression
events. Two methods are possible:</p>
<ul>
<li><p>Simple (default): the hazard of TTP relative to PFS is
proportionate to the progression events observed over the follow-up
period relative to the total number of observed PFS events.</p></li>
<li><p>Complex: the hazard of TTP is directly modeled by fitting
survival distributions as with other endpoints.</p></li>
</ul>
<p>The adjustment to RMD estimates can then proceed as with the STMs,
with hazards and survival functions of TTP, PPD and PPS that reflect the
PSM structure (in which PFS and OS endpoints are first estimated), a
chosen model of progression (simple or complex), and then finally the
adjustment to PPD and PPS for background mortality.</p>
</div>
<div id="illustration-of-calculations" class="section level2">
<h2>Illustration of calculations</h2>
<div id="set-up" class="section level3">
<h3>Set-up</h3>
<p>First we load the packages we need - all of which are suggested for
or imported to <em>psm3mkv</em>. If you haven’t installed
<em>psm3mkv</em> yet, please see the <a href="https://github.com/Merck/psm3mkv?tab=readme-ov-file#installation">installation
instructions</a> to install it with its dependencies. Of these, we will
making further use of <span class="citation">Wickham et al.
(2023)</span>, <span class="citation">Riffe (2015)</span> and <span class="citation">Müller and Wickham (2023)</span>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;dplyr&quot;</span>)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;psm3mkv&quot;</span>)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;tibble&quot;</span>)</span></code></pre></div>
</div>
<div id="creating-the-life-table" class="section level3">
<h3>Creating the life table</h3>
<p>In order to apply constraints to background mortality, we need some
background mortality data, in the form of a lifetable. We can take this
from the Human Mortality Database using the <em>HMDHFDplus</em> package
mentioned above (with thanks to Robert Hettle for the recommendation).
The lifetable will need to start from an assumed age at baseline.
Lifetables are constructed by time in years.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co"># HMD HFD package</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;HMDHFDplus&quot;</span>)</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="co"># Assumed population age at baseline (time=0)</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>baseage <span class="ot">&lt;-</span> <span class="fl">51.0</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a><span class="co"># Mortality data - England &amp; Wales, Female, 2019</span></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>mort <span class="ot">&lt;-</span> <span class="fu">readHMDweb</span>(</span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>  <span class="at">CNTRY =</span> <span class="st">&quot;GBRTENW&quot;</span>,</span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a>  <span class="at">item =</span> <span class="st">&quot;fltper_1x1&quot;</span>,</span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a>  <span class="at">username =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a>  <span class="at">password =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a>  <span class="fu">filter</span>(Year <span class="sc">==</span> <span class="dv">2019</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a>  <span class="fu">select</span>(Age, lx, dx) <span class="sc">|&gt;</span></span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Timey =</span> <span class="fu">ceiling</span>(Age <span class="sc">-</span> baseage)) <span class="sc">|&gt;</span></span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a>  <span class="fu">filter</span>(Timey <span class="sc">&gt;=</span> <span class="dv">0</span>)</span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a><span class="co"># The table needs to end with lx=0</span></span>
<span id="cb2-20"><a href="#cb2-20" tabindex="-1"></a>mort <span class="ot">&lt;-</span> <span class="fu">add_row</span>(mort, <span class="at">Age =</span> <span class="dv">111</span>, <span class="at">lx =</span> <span class="dv">0</span>, <span class="at">Timey =</span> <span class="dv">60</span>)</span></code></pre></div>
<p>You will see that the above code cannot run without a login for the
<a href="https://www.mortality.org">Human Mortality Database</a>.
Alternatively, we could just make up a mortality table.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>mort <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>  <span class="at">Timey =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">30</span>,</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>  <span class="at">lx =</span> <span class="dv">10000</span> <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="fl">0.03</span> <span class="sc">*</span> Timey<span class="sc">^</span><span class="fl">1.1</span>),</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>  <span class="at">dx =</span> lx <span class="sc">-</span> <span class="fu">lead</span>(lx),</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>  <span class="at">qx =</span> dx <span class="sc">/</span> lx</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>)</span></code></pre></div>
<p>However we do it, once we have the mortality data, we can apply the
SMR (<span class="math inline">\(R\)</span>) and derive a lifetable from
time zero as required.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="co"># Assumed Standardized Mortality Ratio</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>SMR <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="co"># Recalculate the lifetable with the SMR applied</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>mort<span class="sc">$</span>adjlx <span class="ot">&lt;-</span> mort<span class="sc">$</span>lx</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(mort<span class="sc">$</span>lx)) {</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>  mort<span class="sc">$</span>adjlx[i] <span class="ot">&lt;-</span> mort<span class="sc">$</span>adjlx[i <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> SMR <span class="sc">*</span> mort<span class="sc">$</span>qx[i <span class="sc">-</span> <span class="dv">1</span>])</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>}</span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a><span class="co"># Ensure lx&gt;=0</span></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a>mort<span class="sc">$</span>adjlx[mort<span class="sc">$</span>adjlx <span class="sc">&lt;</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a><span class="co"># Create and view lifetable</span></span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a>ltable <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">lttime =</span> mort<span class="sc">$</span>Timey, <span class="at">lx =</span> mort<span class="sc">$</span>adjlx)</span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a><span class="fu">head</span>(ltable)</span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a><span class="co">#&gt; # A tibble: 6 × 2</span></span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a><span class="co">#&gt;   lttime     lx</span></span>
<span id="cb4-18"><a href="#cb4-18" tabindex="-1"></a><span class="co">#&gt;    &lt;int&gt;  &lt;dbl&gt;</span></span>
<span id="cb4-19"><a href="#cb4-19" tabindex="-1"></a><span class="co">#&gt; 1      0 10000 </span></span>
<span id="cb4-20"><a href="#cb4-20" tabindex="-1"></a><span class="co">#&gt; 2      1  9409.</span></span>
<span id="cb4-21"><a href="#cb4-21" tabindex="-1"></a><span class="co">#&gt; 3      2  8774.</span></span>
<span id="cb4-22"><a href="#cb4-22" tabindex="-1"></a><span class="co">#&gt; 4      3  8151.</span></span>
<span id="cb4-23"><a href="#cb4-23" tabindex="-1"></a><span class="co">#&gt; 5      4  7553.</span></span>
<span id="cb4-24"><a href="#cb4-24" tabindex="-1"></a><span class="co">#&gt; 6      5  6985.</span></span></code></pre></div>
</div>
<div id="obtaining-and-fitting-distributions-to-patient-level-data" class="section level3">
<h3>Obtaining and fitting distributions to patient-level data</h3>
<p>Next we get some patient-level data and fit the PSM and STMs. So far,
we are closely following <code>vignette(&quot;example&quot;)</code>. Time is
assumed to be recorded in the patient-level data in weeks, with
approximately 52.18 weeks per year.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="co"># Get some data</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>bosonc <span class="ot">&lt;-</span> <span class="fu">create_dummydata</span>(<span class="st">&quot;flexbosms&quot;</span>)</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="co"># We&#39;ll make the durations a lot longer</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="co"># so that they will be definitely constrained by the lifetable</span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>bosonc <span class="ot">&lt;-</span> bosonc <span class="sc">|&gt;</span></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a>    <span class="at">pfs.durn =</span> <span class="dv">20</span> <span class="sc">*</span> pfs.durn,</span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>    <span class="at">os.durn =</span> <span class="dv">20</span> <span class="sc">*</span> os.durn,</span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>    <span class="at">ttp.durn =</span> <span class="dv">20</span> <span class="sc">*</span> ttp.durn</span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a>  )</span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a><span class="co"># Fit parametric models to each endpoint</span></span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a>allfits <span class="ot">&lt;-</span> <span class="fu">fit_ends_mods_par</span>(bosonc)</span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a><span class="co"># Bring together preferred fits for each endpoint</span></span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a>  <span class="at">ppd =</span> <span class="fu">find_bestfit</span>(allfits<span class="sc">$</span>ppd, <span class="st">&quot;aic&quot;</span>)<span class="sc">$</span>fit,</span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a>  <span class="at">ttp =</span> <span class="fu">find_bestfit</span>(allfits<span class="sc">$</span>ttp, <span class="st">&quot;aic&quot;</span>)<span class="sc">$</span>fit,</span>
<span id="cb5-20"><a href="#cb5-20" tabindex="-1"></a>  <span class="at">pfs =</span> <span class="fu">find_bestfit</span>(allfits<span class="sc">$</span>pfs, <span class="st">&quot;aic&quot;</span>)<span class="sc">$</span>fit,</span>
<span id="cb5-21"><a href="#cb5-21" tabindex="-1"></a>  <span class="at">os =</span> <span class="fu">find_bestfit</span>(allfits<span class="sc">$</span>os, <span class="st">&quot;aic&quot;</span>)<span class="sc">$</span>fit,</span>
<span id="cb5-22"><a href="#cb5-22" tabindex="-1"></a>  <span class="at">pps_cf =</span> <span class="fu">find_bestfit</span>(allfits<span class="sc">$</span>pps_cf, <span class="st">&quot;aic&quot;</span>)<span class="sc">$</span>fit,</span>
<span id="cb5-23"><a href="#cb5-23" tabindex="-1"></a>  <span class="at">pps_cr =</span> <span class="fu">find_bestfit</span>(allfits<span class="sc">$</span>pps_cr, <span class="st">&quot;aic&quot;</span>)<span class="sc">$</span>fit</span>
<span id="cb5-24"><a href="#cb5-24" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="making-the-projections" class="section level3">
<h3>Making the projections</h3>
<p>We are skipping over any internal or external validation for the
purposes of this vignette, and jump instead straight to making the
survival projections. We will assume a 10 year time horizon.</p>
<p>First we derive a projection using integral formulae, without
lifetable constraints.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="co"># Set time horizon</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>thoz <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="co"># Run the calculations</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>proj1 <span class="ot">&lt;-</span> <span class="fu">calc_allrmds</span>(bosonc, <span class="at">dpam =</span> params, <span class="at">Ty =</span> thoz)</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a><span class="co"># Present the results</span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>res1 <span class="ot">&lt;-</span> proj1<span class="sc">$</span>results <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">method =</span> <span class="st">&quot;int&quot;</span>, <span class="at">lxadj =</span> <span class="st">&quot;no&quot;</span>, <span class="at">psmmeth =</span> <span class="st">&quot;simple&quot;</span>)</span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a>res1 <span class="sc">|&gt;</span> <span class="fu">mutate</span>(</span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a>  <span class="fu">across</span>(<span class="fu">c</span>(pf, pd, os), <span class="sc">~</span> <span class="fu">num</span>(.x, <span class="at">digits =</span> <span class="dv">1</span>))</span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a>)</span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a><span class="co">#&gt; # A tibble: 3 × 7</span></span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a><span class="co">#&gt;          pf        pd        os model  method lxadj psmmeth</span></span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a><span class="co">#&gt;   &lt;num:.1!&gt; &lt;num:.1!&gt; &lt;num:.1!&gt; &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;  </span></span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a><span class="co">#&gt; 1     274.4     118.3     392.7 PSM    int    no    simple </span></span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a><span class="co">#&gt; 2     270.2     119.7     389.9 STM-CF int    no    simple </span></span>
<span id="cb6-17"><a href="#cb6-17" tabindex="-1"></a><span class="co">#&gt; 3     270.2     123.8     393.9 STM-CR int    no    simple</span></span></code></pre></div>
<p>Next we derive a projection using a discretization approximation,
still without any lifetable constraints.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="co"># Run the calculation</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>proj2 <span class="ot">&lt;-</span> <span class="fu">calc_allrmds</span>(bosonc, <span class="at">dpam =</span> params, <span class="at">Ty =</span> thoz, <span class="at">rmdmethod =</span> <span class="st">&quot;disc&quot;</span>)</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a><span class="co"># Present the results</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>res2 <span class="ot">&lt;-</span> proj2<span class="sc">$</span>results <span class="sc">|&gt;</span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">method =</span> <span class="st">&quot;disc&quot;</span>, <span class="at">lxadj =</span> <span class="st">&quot;no&quot;</span>, <span class="at">psmmeth =</span> <span class="st">&quot;simple&quot;</span>)</span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a>res2 <span class="sc">|&gt;</span> <span class="fu">mutate</span>(</span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a>  <span class="fu">across</span>(<span class="fu">c</span>(pf, pd, os), <span class="sc">~</span> <span class="fu">num</span>(.x, <span class="at">digits =</span> <span class="dv">1</span>))</span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a>)</span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a><span class="co">#&gt; # A tibble: 3 × 7</span></span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a><span class="co">#&gt;          pf        pd        os model  method lxadj psmmeth</span></span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a><span class="co">#&gt;   &lt;num:.1!&gt; &lt;num:.1!&gt; &lt;num:.1!&gt; &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;  </span></span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a><span class="co">#&gt; 1     274.2     118.5     392.7 PSM    disc   no    simple </span></span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a><span class="co">#&gt; 2     270.2     120.1     390.3 STM-CF disc   no    simple </span></span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a><span class="co">#&gt; 3     270.2     123.8     394.0 STM-CR disc   no    simple</span></span></code></pre></div>
<p>Discretization has proven fairly accurate. The STM-CR estimate of
mean time alive has reduced by just -0.1 weeks for example, from 393.9
to 394 weeks.</p>
<p>Finally, we use a discretization approximation and apply the
lifetable constraints.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="co"># Run the calculations</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>proj3 <span class="ot">&lt;-</span> <span class="fu">calc_allrmds</span>(bosonc, <span class="at">dpam =</span> params, <span class="at">Ty =</span> thoz, <span class="at">rmdmethod =</span> <span class="st">&quot;disc&quot;</span>, <span class="at">lifetable =</span> ltable)</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="co"># Present the results</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>res3 <span class="ot">&lt;-</span> proj3<span class="sc">$</span>results <span class="sc">|&gt;</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">method =</span> <span class="st">&quot;disc&quot;</span>, <span class="at">lxadj =</span> <span class="st">&quot;yes&quot;</span>, <span class="at">psmmeth =</span> <span class="st">&quot;simple&quot;</span>)</span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>res3 <span class="sc">|&gt;</span> <span class="fu">mutate</span>(</span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>  <span class="fu">across</span>(<span class="fu">c</span>(pf, pd, os), <span class="sc">~</span> <span class="fu">num</span>(.x, <span class="at">digits =</span> <span class="dv">1</span>))</span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a>)</span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a><span class="co">#&gt; # A tibble: 3 × 7</span></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a><span class="co">#&gt;          pf        pd        os model  method lxadj psmmeth</span></span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a><span class="co">#&gt;   &lt;num:.1!&gt; &lt;num:.1!&gt; &lt;num:.1!&gt; &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;  </span></span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a><span class="co">#&gt; 1     274.2      91.9     366.1 PSM    disc   yes   simple </span></span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a><span class="co">#&gt; 2     230.4     108.0     338.4 STM-CF disc   yes   simple </span></span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a><span class="co">#&gt; 3     230.4     111.2     341.6 STM-CR disc   yes   simple</span></span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a></span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a><span class="co"># Proportion of time alive spent in PF</span></span>
<span id="cb8-18"><a href="#cb8-18" tabindex="-1"></a>proppf3 <span class="ot">&lt;-</span> res3<span class="sc">$</span>pf <span class="sc">/</span> res3<span class="sc">$</span>os</span></code></pre></div>
<p>There is now a large difference between the STM-CR compared to the
STM-CF and PSM structures. All structures estimate fairly similar RMD
estimates of being alive (range: 338.4 to 366.1 weeks). The estimate of
mean time alive in the STM-CR structure has reduced by 52.4 weeks from
393.9 to 341.6 weeks.</p>
<p>The proportion of that time in the PF rather than PD state varies
considerably (PSM: 74.9%, STM-CF: 68.1%, STM-CR: 67.5%). Given that the
hazard of mortality would typically be lower before rather than after
progression, the pre-progression mortality is likely to be more affected
by any mortality constraint that post-progression mortality. The STM-CR
model of post-progression survival depends on time from progression and
is therefore rather different from the STM-CF and PSM structures, which
model mortality based on time from baseline.</p>
<p>We can check whether using a ‘complex’ type of PSM structure rather
than the default ‘simple’ affects RMD estimates from the PSM
structure.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="co"># Run the calculations</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>proj4 <span class="ot">&lt;-</span> <span class="fu">calc_allrmds</span>(bosonc, <span class="at">dpam =</span> params, <span class="at">Ty =</span> thoz, <span class="at">psmtype =</span> <span class="st">&quot;complex&quot;</span>, <span class="at">rmdmethod =</span> <span class="st">&quot;disc&quot;</span>, <span class="at">lifetable =</span> ltable)</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="co"># Present the results</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>res4 <span class="ot">&lt;-</span> proj4<span class="sc">$</span>results <span class="sc">|&gt;</span></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">method =</span> <span class="st">&quot;disc&quot;</span>, <span class="at">lxadj =</span> <span class="st">&quot;yes&quot;</span>, <span class="at">psmmeth =</span> <span class="st">&quot;complex&quot;</span>)</span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a>res4 <span class="sc">|&gt;</span> <span class="fu">mutate</span>(</span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a>  <span class="fu">across</span>(<span class="fu">c</span>(pf, pd, os), <span class="sc">~</span> <span class="fu">num</span>(.x, <span class="at">digits =</span> <span class="dv">1</span>))</span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a>)</span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a><span class="co">#&gt; # A tibble: 3 × 7</span></span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a><span class="co">#&gt;          pf        pd        os model  method lxadj psmmeth</span></span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a><span class="co">#&gt;   &lt;num:.1!&gt; &lt;num:.1!&gt; &lt;num:.1!&gt; &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;  </span></span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a><span class="co">#&gt; 1     272.9      93.2     366.1 PSM    disc   yes   complex</span></span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a><span class="co">#&gt; 2     230.4     108.0     338.4 STM-CF disc   yes   complex</span></span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a><span class="co">#&gt; 3     230.4     111.2     341.6 STM-CR disc   yes   complex</span></span>
<span id="cb9-16"><a href="#cb9-16" tabindex="-1"></a></span>
<span id="cb9-17"><a href="#cb9-17" tabindex="-1"></a><span class="co"># Proportion of time alive spent in PF</span></span>
<span id="cb9-18"><a href="#cb9-18" tabindex="-1"></a>proppf4 <span class="ot">&lt;-</span> res4<span class="sc">$</span>pf <span class="sc">/</span> res4<span class="sc">$</span>os</span></code></pre></div>
<p>All structures estimate fairly similar RMD estimates of being alive
(range: 338.4 to 366.1 weeks). The proportion of that time in the PF
rather than PD state varied again considerably by model structure (PSM:
74.5%, STM-CF: 68.1%, STM-CR: 67.5%).</p>
</div>
<div id="comparing-the-results" class="section level3">
<h3>Comparing the results</h3>
<p>A summary of the STM-CF estimates of mean time in PF state and mean
time alive is given in the table below.</p>
<table>
<colgroup>
<col width="26%" />
<col width="18%" />
<col width="18%" />
<col width="18%" />
<col width="18%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Model</th>
<th align="left">Mean time in PF (weeks)</th>
<th align="left">Change (weeks)</th>
<th align="left">Mean time alive (weeks)</th>
<th align="left">Change (weeks)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">No lifetable constraint, integral methods</td>
<td align="left">270.2</td>
<td align="left">-</td>
<td align="left">389.9</td>
<td align="left">-</td>
</tr>
<tr class="even">
<td align="left">No lifetable constraint, discretized calculation</td>
<td align="left">270.2</td>
<td align="left">0.1</td>
<td align="left">390.3</td>
<td align="left">0.4</td>
</tr>
<tr class="odd">
<td align="left">With lifetable constraint, discretized calculation</td>
<td align="left">230.4</td>
<td align="left">-39.8</td>
<td align="left">338.4</td>
<td align="left">-51.5</td>
</tr>
</tbody>
</table>
<p>In this fictional case, the application of a lifetable constraint had
fairly sizeable effects on the results - although this was by design of
this demonstration.</p>
<p>A summary of the STM-CR estimates of mean time in PF state and mean
time alive is given in the table below.</p>
<table>
<colgroup>
<col width="26%" />
<col width="18%" />
<col width="18%" />
<col width="18%" />
<col width="18%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Model</th>
<th align="left">Mean time in PF (weeks)</th>
<th align="left">Change (weeks)</th>
<th align="left">Mean time alive (weeks)</th>
<th align="left">Change (weeks)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">No lifetable constraint, integral methods</td>
<td align="left">270.2</td>
<td align="left">-</td>
<td align="left">393.9</td>
<td align="left">-</td>
</tr>
<tr class="even">
<td align="left">No lifetable constraint, discretized calculation</td>
<td align="left">270.2</td>
<td align="left">0.1</td>
<td align="left">394</td>
<td align="left">0.1</td>
</tr>
<tr class="odd">
<td align="left">With lifetable constraint, discretized calculation</td>
<td align="left">230.4</td>
<td align="left">-39.8</td>
<td align="left">341.6</td>
<td align="left">-52.4</td>
</tr>
</tbody>
</table>
<p>The application of a lifetable constraint had similar and fairly
sizeable effects on the results here also.</p>
<p>A summary of the PSM estimates of mean time in PF state and mean time
alive is given in the table below.</p>
<table>
<colgroup>
<col width="26%" />
<col width="18%" />
<col width="18%" />
<col width="18%" />
<col width="18%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Model</th>
<th align="left">Mean time in PF (weeks)</th>
<th align="left">Change (weeks)</th>
<th align="left">Mean time alive (weeks)</th>
<th align="left">Change (weeks)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">No lifetable constraint, integral methods, simple
PSM</td>
<td align="left">274.4</td>
<td align="left">-</td>
<td align="left">392.7</td>
<td align="left">-</td>
</tr>
<tr class="even">
<td align="left">No lifetable constraint, discretized calculation,
simple PSM</td>
<td align="left">274.2</td>
<td align="left">-0.2</td>
<td align="left">392.7</td>
<td align="left">0</td>
</tr>
<tr class="odd">
<td align="left">With lifetable constraint, discretized calculation,
simple PSM</td>
<td align="left">274.2</td>
<td align="left">-0.2</td>
<td align="left">366.1</td>
<td align="left">-26.6</td>
</tr>
<tr class="even">
<td align="left">With lifetable constraint, discretized calculation,
complex PSM</td>
<td align="left">272.9</td>
<td align="left">-1.5</td>
<td align="left">366.1</td>
<td align="left">-26.6</td>
</tr>
</tbody>
</table>
<p>The change in the RMDs for the ‘complex’ PSM structure compared to
the ‘simple’ PSM structure were -1.3, 1.3 and 0 weeks respectively for
time in PF state, PD state and time alive.</p>
</div>
<div id="for-further-investigation" class="section level3">
<h3>For further investigation</h3>
<ul>
<li>The effect of the lifetable constraint on the STMs was much greater
- especially to time in the PF state - in the STMs rather than the
PSM.</li>
<li>The package also allows application of discounting through the
<code>discrate</code> optional call to <code>calc_allrnds()</code>.</li>
</ul>
</div>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="unnumbered">References</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-jackson2016flexsurv" class="csl-entry">
Jackson, Christopher. 2016. <span>“<span class="nocase">flexsurv</span>:
A Platform for Parametric Survival Modeling in <span>R</span>.”</span>
<em>Journal of Statistical Software</em> 70 (8): 1–33.
</div>
<div id="ref-pack_tibble" class="csl-entry">
Müller, Kirill, and Hadley Wickham. 2023. <em>Tibble: Simple Data
Frames</em>. <a href="https://CRAN.R-project.org/package=tibble">https://CRAN.R-project.org/package=tibble</a>.
</div>
<div id="ref-muston2024informing" class="csl-entry">
Muston, Dominic. 2024. <span>“Informing Structural Assumptions for Three
State Oncology Cost-Effectiveness Models Through Model Efficiency and
Fit.”</span> <em>Applied Health Economics and Health Policy</em>.
</div>
<div id="ref-naimark2013half" class="csl-entry">
Naimark, David MJ, Nader N Kabboul, and Murray D Krahn. 2013. <span>“The
Half-Cycle Correction Revisited: Redemption of a Kludge.”</span>
<em>Medical Decision Making</em> 33 (7): 961–70.
</div>
<div id="ref-nice2022" class="csl-entry">
National Institute for Health and Care Excellence. 2022.
<span>“Avalglucosidase Alfa for Treating <span>Pompe</span>
Disease.”</span> Technology appraisal guidance TA821. London, UK:
National Institute for Health; Care Excellence. <a href="https://www.nice.org.uk/guidance/ta821/documents/committee-papers">https://www.nice.org.uk/guidance/ta821/documents/committee-papers</a>.
</div>
<div id="ref-pack_HMDHFDplus" class="csl-entry">
Riffe, Tim. 2015. <span>“Reading Human Fertility Database and Human
Mortality Database Data into r.”</span> TR-2015-004. MPIDR. <a href="https://doi.org/10.4054/MPIDR-TR-2015-004">https://doi.org/10.4054/MPIDR-TR-2015-004</a>.
</div>
<div id="ref-sweeting2023survival" class="csl-entry">
Sweeting, Michael J, Mark J Rutherford, Dan Jackson, Sangyu Lee,
Nicholas R Latimer, Robert Hettle, and Paul C Lambert. 2023.
<span>“Survival Extrapolation Incorporating General Population Mortality
Using Excess Hazard and Cure Models: A Tutorial.”</span> <em>Medical
Decision Making</em> 43 (6): 737–48.
</div>
<div id="ref-pack_dplyr" class="csl-entry">
Wickham, Hadley, Romain François, Lionel Henry, Kirill Müller, and Davis
Vaughan. 2023. <em>Dplyr: A Grammar of Data Manipulation</em>. <a href="https://CRAN.R-project.org/package=dplyr">https://CRAN.R-project.org/package=dplyr</a>.
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
